<!--
    Authors:
        - Michael Hills
        - Kate Belson 
        - Jack Purkiss
-->

{% extends 'base.html' %}
<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <title>My Responses</title>  
</head>  



{% block filter %}

{% include 'sidebar.html' %}
    
{% endblock %}



{% block content %}



<h1 id="title">Recent Activity</h1>

{% load static %}
<link rel="stylesheet" href="{% static 'StyleSheet.css'%}">


<div>
    {% csrf_token %}
    
    {% for response in responses %}
        <div class="challenge">
            <div id="profile-pic"  style="float:left">
                <img class="rounded-circle account-img" src="{{ response.user.profile.picture.url }}" width="100" height="100"></img>
            </div>
            <h5><a href="{% url 'challengeResponses' response.challenge.id%}">{{response.challenge.name}}</a> | <small>{{response.challenge.points}}</small></h5>
            <h5></h5><a href="{% url 'userResponses' response.user.id%}">{{response.user.username}}</a></h5><br>

            <img id="chal-photo" src="{{ response.photograph.url }}" alt="image" />
            <br>
            <small>{{response.description}} </small> <br>
            {% include 'like.html' %}
            <small>Comments: </small><br>
            <small><a href="{% url 'createComments' response.id %}">Add Comment</a></small><br>
            

            <hr>

            {% if not response.comments.all %}
            <small>No comments yet</small>
            {%else%}
            <small><a href="{% url 'viewComments' response.id %}">See All Comments</a></small>

            <div  style= "height: 100px; overflow-y: scroll;" >
            
                {% for comment in comments %}
                    {% if comment.response == response %}
                    
                    <small> <a  href="{% url 'userResponses' comment.user.id%}">{{comment.user}}</a> {{comment.text}} </small>
                    <br>

                    {% endif %}

                {% endfor %}

            </div>

            {% endif %}
        
            
        </div>
    {% endfor %}
</div>

</body>

<script>

    const csrf = document.querySelector('[name=csrfmiddlewaretoken]').value;

    
    function postData(id){

        var req = new XMLHttpRequest();
        var url = "{% url 'like-post' %}";
        req.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                count = document.getElementById("num-"+id).innerHTML += 1;
            } else if (this.readyState == 4 && this.status != 200) {
                alert("!200");
            }
        };


        // Probably add user identification here
        req.open("POST", url);
        req.setRequestHeader('X-CSRFToken', csrf)
        req.setRequestHeader("Content-Type", "text/plain");
        req.send(id);
    }
</script>

{% endblock %}
</html>